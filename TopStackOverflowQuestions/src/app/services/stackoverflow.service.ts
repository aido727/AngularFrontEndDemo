import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { catchError, Observable, throwError } from 'rxjs';
import { ResultObject } from '../models/stackoverflow.model';

@Injectable({
	providedIn: 'root'
})

export class StackOverflowService {
	private endpoint = "https://api.stackexchange.com/2.2";
    constructor(private http: HttpClient) { }

	public getTopQuestions(amount: number) : Observable<ResultObject> {
        return this.http.get<ResultObject>(this.endpoint + '/questions?pagesize=' + amount + '&order=desc&sort=votes&site=stackoverflow')
		.pipe(
			catchError(error => {
				let errorMsg = "";
				if (error.error instanceof ErrorEvent) {
					errorMsg = `Error: ${error.error.message}`;
				} else {
					errorMsg = `Error: ${error.message}`;
				}
				return throwError(() => new Error(errorMsg));
			})
		)

		// fake return for developing without having to keep calling the API
		// return new Observable(subscriber => {
		// 	let json = '{"items": [ { "tags": [ "java", "c++", "performance", "cpu-architecture", "branch-prediction" ], "owner": { "reputation": 477586, "user_id": 87234, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FkjBe.png?s=256&g=1", "display_name": "GManNickG", "link": "https://stackoverflow.com/users/87234/gmannickg" }, "is_answered": true, "view_count": 1710573, "protected_date": 1399067470, "accepted_answer_id": 11227902, "answer_count": 27, "score": 26371, "last_activity_date": 1650591088, "creation_date": 1340805096, "last_edit_date": 1634760446, "question_id": 11227809, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/11227809/why-is-processing-a-sorted-array-faster-than-processing-an-unsorted-array", "title": "Why is processing a sorted array faster than processing an unsorted array?" }, { "tags": [ "git", "version-control", "git-commit", "undo" ], "owner": { "reputation": 48387, "user_id": 89904, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4fef65cead13e5d519f6bce3c501a537?s=256&d=identicon&r=PG", "display_name": "Hamza Yerlikaya", "link": "https://stackoverflow.com/users/89904/hamza-yerlikaya" }, "is_answered": true, "view_count": 10996507, "protected_date": 1370840488, "accepted_answer_id": 927386, "answer_count": 98, "community_owned_date": 1363428511, "score": 24261, "last_activity_date": 1651015043, "creation_date": 1243620554, "last_edit_date": 1641586989, "question_id": 927358, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/927358/how-do-i-undo-the-most-recent-local-commits-in-git", "title": "How do I undo the most recent local commits in Git?" }, { "tags": [ "git", "version-control", "git-branch", "git-push", "git-remote" ], "owner": { "reputation": 429406, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uMfjc.jpg?s=256&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin" }, "is_answered": true, "view_count": 9886935, "protected_date": 1358718496, "accepted_answer_id": 2003515, "answer_count": 41, "score": 19169, "last_activity_date": 1648093375, "creation_date": 1262653935, "last_edit_date": 1633559915, "question_id": 2003505, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/2003505/how-do-i-delete-a-git-branch-locally-and-remotely", "title": "How do I delete a Git branch locally and remotely?" }, { "tags": [ "git", "version-control", "git-pull", "git-fetch" ], "owner": { "reputation": 266510, "user_id": 6068, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/931970b8dc51b72e05e3a12b88612d61?s=256&d=identicon&r=PG", "display_name": "pupeno", "link": "https://stackoverflow.com/users/6068/pupeno" }, "is_answered": true, "view_count": 3175569, "protected_date": 1362879044, "accepted_answer_id": 292359, "answer_count": 39, "score": 13171, "last_activity_date": 1650707829, "creation_date": 1226742669, "last_edit_date": 1606492916, "question_id": 292357, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/292357/what-is-the-difference-between-git-pull-and-git-fetch", "title": "What is the difference between &#39;git pull&#39; and &#39;git fetch&#39;?" }, { "tags": [ "python" ], "owner": { "reputation": 135545, "user_id": 18300, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jcyI4.jpg?s=256&g=1", "display_name": "Alex. S.", "link": "https://stackoverflow.com/users/18300/alex-s" }, "is_answered": true, "view_count": 2898736, "protected_date": 1360547307, "accepted_answer_id": 231855, "answer_count": 47, "score": 12006, "last_activity_date": 1650277895, "creation_date": 1224800471, "last_edit_date": 1650277895, "question_id": 231767, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do", "title": "What does the &quot;yield&quot; keyword do?" }, { "tags": [ "json" ], "owner": { "reputation": 227667, "user_id": 12870, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/f0af40756420859b5b63cbceb6d30505?s=256&d=identicon&r=PG", "display_name": "Oli", "link": "https://stackoverflow.com/users/12870/oli" }, "is_answered": true, "view_count": 3452994, "protected_date": 1435276338, "accepted_answer_id": 477819, "answer_count": 38, "score": 11145, "last_activity_date": 1651763685, "creation_date": 1232897119, "last_edit_date": 1651763685, "question_id": 477816, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/477816/what-is-the-correct-json-content-type", "title": "What is the correct JSON content type?" }, { "tags": [ "javascript", "arrays" ], "owner": { "reputation": 117117, "user_id": 364969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/79e7cefc9e7deb0e0bf422baa1a38a2c?s=256&d=identicon&r=PG", "display_name": "Walker", "link": "https://stackoverflow.com/users/364969/walker" }, "is_answered": true, "view_count": 9904864, "protected_date": 1418673600, "accepted_answer_id": 5767357, "answer_count": 131, "score": 10570, "last_activity_date": 1652198246, "creation_date": 1303597038, "last_edit_date": 1648469645, "question_id": 5767325, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/5767325/how-can-i-remove-a-specific-item-from-an-array", "title": "How can I remove a specific item from an array?" }, { "tags": [ "git", "undo", "git-revert", "git-add" ], "owner": { "reputation": 144341, "user_id": 14069, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/0c29cc6ee1c170810ee1fd36fa7c2f95?s=256&d=identicon&r=PG", "display_name": "paxos1977", "link": "https://stackoverflow.com/users/14069/paxos1977" }, "is_answered": true, "view_count": 4331065, "protected_date": 1359649207, "accepted_answer_id": 348234, "answer_count": 37, "score": 10467, "last_activity_date": 1650166398, "creation_date": 1228687066, "last_edit_date": 1638169982, "question_id": 348170, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/348170/how-do-i-undo-git-add-before-commit", "title": "How do I undo &#39;git add&#39; before commit?" }, { "tags": [ "git", "version-control", "git-branch" ], "owner": { "reputation": 112993, "user_id": 338204, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/c145a12cd17d3b3ffff033681a694abe?s=256&d=identicon&r=PG", "display_name": "Forrest", "link": "https://stackoverflow.com/users/338204/forrest" }, "is_answered": true, "view_count": 4202020, "protected_date": 1498428177, "accepted_answer_id": 6591218, "answer_count": 38, "score": 10399, "last_activity_date": 1651919011, "creation_date": 1309922436, "last_edit_date": 1629097997, "question_id": 6591213, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/6591213/how-do-i-rename-a-local-git-branch", "title": "How do I rename a local Git branch?" }, { "tags": [ "c", "operators", "code-formatting", "standards-compliance" ], "owner": { "reputation": 477586, "user_id": 87234, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FkjBe.png?s=256&g=1", "display_name": "GManNickG", "link": "https://stackoverflow.com/users/87234/gmannickg" }, "is_answered": true, "view_count": 914366, "protected_date": 1297320482, "accepted_answer_id": 1642035, "answer_count": 28, "community_owned_date": 1262233068, "score": 9736, "last_activity_date": 1650522053, "creation_date": 1256799465, "last_edit_date": 1646057415, "question_id": 1642028, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/1642028/what-is-the-operator-in-c-c", "title": "What is the &quot;--&gt;&quot; operator in C/C++?" } ], "has_more": true, "quota_max": 300, "quota_remaining": 297 }';
		// 	subscriber.next(JSON.parse(json));
		// 	subscriber.complete()
		// })
    }
}


